<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voklcreate ‚Äì Kalkulacka</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #080808; --dark: #0f0f0f; --card: #141414; --border: #262626;
    --accent: #c8a055; --accent2: #e2bb72; --white: #ede8df;
    --muted: #666; --muted2: #888; --red: #c94f3d; --green: #4caf7d; --orange: #e07c3a;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--black); color:var(--white); font-family:'DM Sans',sans-serif; min-height:100vh; overflow-x:hidden; }
  body::after { content:''; position:fixed; inset:0; background:radial-gradient(ellipse 60% 50% at 50% -10%, rgba(200,160,85,0.07) 0%, transparent 70%); pointer-events:none; z-index:0; }
  header { position:relative; z-index:10; border-bottom:1px solid var(--border); padding:22px 48px; display:flex; align-items:center; gap:24px; background:rgba(8,8,8,0.96); }
  .logo { font-family:'Bebas Neue',sans-serif; font-size:2rem; letter-spacing:4px; color:var(--accent); }
  .logo-div { width:1px; height:36px; background:var(--border); }
  .logo-sub { font-size:0.7rem; letter-spacing:2.5px; text-transform:uppercase; color:var(--muted2); line-height:1.6; }
  main { position:relative; z-index:1; max-width:800px; margin:0 auto; padding:64px 24px 100px; }
  .hero { text-align:center; margin-bottom:64px; }
  .hero-label { display:inline-block; font-size:0.68rem; letter-spacing:4px; text-transform:uppercase; color:var(--accent); border:1px solid rgba(200,160,85,0.3); padding:6px 18px; border-radius:100px; margin-bottom:28px; }
  .hero h1 { font-family:'Bebas Neue',sans-serif; font-size:clamp(3.5rem,10vw,6.5rem); line-height:0.88; letter-spacing:2px; color:var(--white); margin-bottom:24px; }
  .hero h1 em { color:var(--accent); font-style:normal; }
  .hero p { color:var(--muted2); font-size:0.95rem; max-width:460px; margin:0 auto; line-height:1.7; }
  .steps-bar { display:flex; align-items:center; margin-bottom:40px; }
  .step-item { display:flex; flex-direction:column; align-items:center; gap:8px; flex:1; }
  .step-circle { width:38px; height:38px; border-radius:50%; border:1px solid var(--border); background:var(--dark); display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:1rem; color:var(--muted); transition:all 0.4s; }
  .step-line { flex:1; height:1px; background:var(--border); position:relative; top:-12px; }
  .step-lbl { font-size:0.65rem; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); }
  .step-item.active .step-circle { border-color:var(--accent); color:var(--accent); background:rgba(200,160,85,0.08); }
  .step-item.active .step-lbl { color:var(--accent); }
  .step-item.done .step-circle { border-color:var(--green); color:var(--green); background:rgba(76,175,125,0.08); }
  .step-item.done .step-lbl { color:var(--green); }
  .card { background:var(--card); border:1px solid var(--border); border-radius:3px; padding:40px; margin-bottom:20px; position:relative; overflow:hidden; }
  .card::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,rgba(200,160,85,0.4),transparent); }
  .card-title { font-family:'Bebas Neue',sans-serif; font-size:1.5rem; letter-spacing:3px; color:var(--accent); margin-bottom:6px; }
  .card-desc { font-size:0.82rem; color:var(--muted2); margin-bottom:28px; line-height:1.6; }
  .upload-zone { border:2px dashed var(--border); border-radius:3px; padding:52px 32px; text-align:center; cursor:pointer; transition:all 0.3s; position:relative; }
  .upload-zone:hover, .upload-zone.over { border-color:var(--accent); background:rgba(200,160,85,0.03); }
  .upload-zone input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
  .upload-icon { font-size:2.8rem; margin-bottom:16px; }
  .upload-zone h3 { font-family:'Bebas Neue',sans-serif; font-size:1.3rem; letter-spacing:3px; margin-bottom:8px; }
  .upload-zone p { font-size:0.78rem; color:var(--muted); }
  #previewWrap { display:none; position:relative; }
  #previewWrap.show { display:block; }
  #previewImg { width:100%; max-height:320px; object-fit:contain; border:1px solid var(--border); border-radius:2px; }
  #removeBtn { position:absolute; top:10px; right:10px; width:32px; height:32px; border-radius:50%; background:rgba(10,10,10,0.85); border:1px solid var(--border); color:var(--white); cursor:pointer; font-size:0.9rem; display:flex; align-items:center; justify-content:center; }
  .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .fg { display:flex; flex-direction:column; gap:7px; }
  .fg.span2 { grid-column:1/-1; }
  label { font-size:0.68rem; letter-spacing:2px; text-transform:uppercase; color:var(--muted2); }
  input, textarea { background:var(--dark); border:1px solid var(--border); color:var(--white); padding:11px 14px; font-family:'DM Sans',sans-serif; font-size:0.88rem; border-radius:2px; outline:none; transition:border-color 0.2s; width:100%; }
  input:focus, textarea:focus { border-color:var(--accent); }
  textarea { resize:vertical; min-height:80px; }
  ::placeholder { color:var(--muted); }
  .btn { display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:15px 36px; border:none; cursor:pointer; font-family:'Bebas Neue',sans-serif; font-size:1.05rem; letter-spacing:3px; border-radius:2px; transition:all 0.25s; width:100%; }
  .btn-gold { background:var(--accent); color:#080808; }
  .btn-gold:hover { background:var(--accent2); transform:translateY(-1px); }
  .btn-gold:disabled { opacity:0.35; cursor:not-allowed; transform:none; }
  .btn-outline { background:transparent; color:var(--accent); border:1px solid rgba(200,160,85,0.4); margin-top:10px; }
  #loadingDiv { display:none; text-align:center; padding:80px 40px; }
  #loadingDiv.show { display:block; }
  .spin { width:44px; height:44px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:rot 0.9s linear infinite; margin:0 auto 28px; }
  @keyframes rot { to { transform:rotate(360deg); } }
  .loading-title { font-family:'Bebas Neue',sans-serif; font-size:1.6rem; letter-spacing:4px; color:var(--accent); margin-bottom:8px; }
  .loading-steps { font-size:0.8rem; color:var(--muted); line-height:2; }
  .loading-steps span { display:block; opacity:0; animation:fadeIn 0.5s forwards; }
  .loading-steps span:nth-child(1) { animation-delay:0.3s; }
  .loading-steps span:nth-child(2) { animation-delay:1.4s; }
  .loading-steps span:nth-child(3) { animation-delay:2.6s; }
  @keyframes fadeIn { to { opacity:1; } }
  #resultDiv { display:none; }
  #resultDiv.show { display:block; }
  .status-badge { display:inline-flex; align-items:center; gap:8px; padding:7px 18px; border-radius:100px; font-size:0.72rem; letter-spacing:1.5px; text-transform:uppercase; font-weight:600; margin-bottom:24px; }
  .badge-ok { background:rgba(76,175,125,0.12); color:var(--green); border:1px solid rgba(76,175,125,0.25); }
  .badge-grafik { background:rgba(224,124,58,0.12); color:var(--orange); border:1px solid rgba(224,124,58,0.25); }
  .badge-no { background:rgba(201,79,61,0.12); color:var(--red); border:1px solid rgba(201,79,61,0.25); }
  .price-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:24px; }
  .pbox { background:var(--dark); border:1px solid var(--border); padding:22px; border-radius:2px; text-align:center; }
  .pbox.gold { border-color:rgba(200,160,85,0.4); background:rgba(200,160,85,0.04); }
  .pbox-label { font-size:0.66rem; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:8px; }
  .pbox-val { font-family:'Bebas Neue',sans-serif; font-size:1.9rem; letter-spacing:2px; color:var(--white); }
  .pbox.gold .pbox-val { color:var(--accent); }
  .pbox-note { font-size:0.72rem; color:var(--muted); margin-top:4px; }
  .analysis-box { background:var(--dark); border-left:3px solid var(--accent); padding:20px 22px; border-radius:0 2px 2px 0; font-size:0.88rem; line-height:1.75; color:var(--white); margin-bottom:24px; }
  .grafik-notice { background:rgba(224,124,58,0.06); border:1px solid rgba(224,124,58,0.2); border-radius:2px; padding:18px 22px; font-size:0.83rem; line-height:1.65; color:var(--muted2); margin-bottom:24px; }
  .grafik-notice strong { color:var(--orange); }
  .contact-block { border-top:1px solid var(--border); margin-top:32px; padding-top:32px; }
  .contact-block h3 { font-family:'Bebas Neue',sans-serif; font-size:1.3rem; letter-spacing:3px; color:var(--accent); margin-bottom:6px; }
  .contact-block p { font-size:0.82rem; color:var(--muted2); margin-bottom:22px; }
  .info-strip { display:grid; grid-template-columns:repeat(3,1fr); gap:1px; background:var(--border); border:1px solid var(--border); border-radius:2px; margin-bottom:20px; overflow:hidden; }
  .info-cell { background:var(--card); padding:20px; text-align:center; }
  .info-cell .ic-icon { font-size:1.4rem; margin-bottom:8px; }
  .info-cell .ic-title { font-size:0.72rem; letter-spacing:1.5px; text-transform:uppercase; color:var(--accent); margin-bottom:4px; }
  .info-cell .ic-val { font-size:0.82rem; color:var(--muted2); line-height:1.4; }
  #successDiv { display:none; text-align:center; padding:60px 20px; }
  #successDiv.show { display:block; }
  .success-icon { font-size:3.5rem; margin-bottom:20px; }
  .success-title { font-family:'Bebas Neue',sans-serif; font-size:2.4rem; letter-spacing:4px; color:var(--green); margin-bottom:12px; }
  .success-sub { font-size:0.88rem; color:var(--muted2); line-height:1.7; margin-bottom:32px; }
  footer { position:relative; z-index:1; border-top:1px solid var(--border); padding:20px 48px; text-align:center; font-size:0.72rem; color:var(--muted); letter-spacing:1px; }
  @media (max-width:600px) {
    header { padding:18px 20px; } main { padding:40px 16px 60px; } .card { padding:24px 20px; }
    .form-grid { grid-template-columns:1fr; } .fg.span2 { grid-column:1; }
    .price-grid { grid-template-columns:1fr; } .info-strip { grid-template-columns:1fr; }
    .hero h1 { font-size:3.2rem; } .upload-zone { padding:36px 20px; }
  }
</style>
</head>
<body>
<header>
  <div class="logo">VOKLCREATE</div>
  <div class="logo-div"></div>
  <div class="logo-sub">Zak√°zkov√© taftovan√© koberce<br>voklcustom@gmail.com</div>
</header>

<main>
  <div class="hero">
    <div class="hero-label">Okamzita cenova kalkulacka</div>
    <h1>KOBEREC<br><em>PRESNE</em><br>PRO TEBE</h1>
    <p>Nahraj obrazek sveho vzoru. AI analyzuje slozitost, porovn√° s referencnimi vzory a navrhne idealni rozmer i orientacni cenu.</p>
  </div>

  <div class="steps-bar">
    <div class="step-item active" id="si1"><div class="step-circle">1</div><div class="step-lbl">Vzor</div></div>
    <div class="step-line"></div>
    <div class="step-item" id="si2"><div class="step-circle">2</div><div class="step-lbl">Analyza</div></div>
    <div class="step-line"></div>
    <div class="step-item" id="si3"><div class="step-circle">3</div><div class="step-lbl">Nabidka</div></div>
    <div class="step-line"></div>
    <div class="step-item" id="si4"><div class="step-circle">4</div><div class="step-lbl">Kontakt</div></div>
  </div>

  <div id="phase1">
    <div class="card">
      <div class="card-title">Nahraj svuj vzor</div>
      <div class="card-desc">Jakykoli format ‚Äî JPG, PNG, AI, EPS. Cim jasnejsi vzor s ostrymi hranami, tim presnejsi kalkulace.</div>
      <div class="upload-zone" id="uploadZone">
        <input type="file" id="fileInput" accept="image/*">
        <div class="upload-icon">üé®</div>
        <h3>Pretahni nebo vyber obrazek</h3>
        <p>JPG, PNG, WEBP a dalsi obrazove formaty</p>
      </div>
      <div id="previewWrap">
        <img id="previewImg" src="" alt="Nahled vzoru">
        <button id="removeBtn">X</button>
      </div>
    </div>

    <div class="info-strip">
      <div class="info-cell">
        <div class="ic-icon">üß∂</div>
        <div class="ic-title">65 barev</div>
        <div class="ic-val">Vlastni paleta premiov√Ωch priz√≠ Voklcreate</div>
      </div>
      <div class="info-cell">
        <div class="ic-icon">üìê</div>
        <div class="ic-title">Rozmer na miru</div>
        <div class="ic-val">AI doporuci minimum dle slozitosti vzoru</div>
      </div>
      <div class="info-cell">
        <div class="ic-icon">‚ö°</div>
        <div class="ic-title">Grafika zdarma</div>
        <div class="ic-val">Pri objednavce koberce ‚Äì bez priplatku</div>
      </div>
    </div>

    <button class="btn btn-gold" id="analyzeBtn" disabled>
      ANALYZOVAT VZOR A ZISKAT CENU
    </button>
  </div>

  <div id="loadingDiv">
    <div class="spin"></div>
    <div class="loading-title">Analyzuji vzor...</div>
    <div class="loading-steps">
      <span>Detekuji barvy a prechody...</span>
      <span>Porovnavam slozitost s referencnimi vzory...</span>
      <span>Kalkuluji cenu a doporucuji rozmer...</span>
    </div>
  </div>

  <div id="resultDiv">
    <div class="card">
      <div id="statusBadge"></div>
      <div id="priceGrid"></div>
      <div class="analysis-box" id="analysisBox"></div>
      <div id="grafikNotice"></div>
      <div class="contact-block" id="contactBlock">
        <h3>Potvrdit poptavku</h3>
        <p id="contactDesc">Vypl≈à kontaktni udaje ‚Äî ozveme se s potvrzenim a detaily vyroby.</p>
        <div class="form-grid">
          <div class="fg"><label>Jmeno a prijmeni *</label><input type="text" id="cName" placeholder="Jan Novak"></div>
          <div class="fg"><label>E-mail *</label><input type="email" id="cEmail" placeholder="jan@email.cz"></div>
          <div class="fg"><label>Telefon</label><input type="tel" id="cPhone" placeholder="+420 777 123 456"></div>
          <div class="fg"><label>Preferovany rozmer (cm)</label><input type="text" id="cSize" placeholder="napr. 90x90 cm"></div>
          <div class="fg span2"><label>Poznamka</label><textarea id="cNote" placeholder="Barvy z palety, termin, jine pozadavky..."></textarea></div>
        </div>
        <button class="btn btn-gold" id="sendBtn" style="margin-top:20px">ODESLAT POPTAVKU</button>
        <button class="btn btn-outline" id="restartBtn">NAHRAT JINY VZOR</button>
      </div>
    </div>
  </div>

  <div id="successDiv">
    <div class="success-icon">‚úÖ</div>
    <div class="success-title">Poptavka odeslana!</div>
    <div class="success-sub">
      Tvoje poptavka dorazila na voklcustom@gmail.com.<br>
      Ozveme se co nejdrive s potvrzenim a detaily vyroby.<br>
      Dekujeme za zajem o Voklcreate!
    </div>
    <button class="btn btn-outline" id="restartBtn2" style="max-width:280px;margin:0 auto">NOVA KALKULACE</button>
  </div>
</main>

<footer>2025 VOKLCREATE ‚Äî Zakazkove taftovane koberce ¬∑ voklcustom@gmail.com</footer>
<script>
const API_KEY = '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';
const OWNER_EMAIL = 'voklcustom@gmail.com';
const SYSTEM_PROMPT = `Jsi expert na zakazkove taftovane koberce Voklcreate. Analyzujes obrazky vzoru.

REFERENCNI CENIK:
Real Madrid znak: min. 90cm vyska, 4860 Kc
Barcelona znak: min. 80cm vyska, 4760 Kc
Velo puk kulate: min. 70cm prumer, 3760 Kc
BVB znak kulate: min. 60cm prumer, 2860 Kc
Liverpool: min. 120cm vyska, 8660 Kc
Arsenal: min. 90cm vyska, 4860 Kc
Chelsea kulate: min. 90cm prumer, 5860 Kc
Harley Davidson: min. 90cm sirka, 5860 Kc
Colorado Avalanche: min. 100cm, 6360 Kc
Sparta Praha novy kruh: min. 60cm, 3360 Kc
Slovan Bratislava bez hvezd: min. 90cm vyska, 5760 Kc
Manchester United: min. 90cm, 5860 Kc
Sparta Slavia Praha: min. 90cm, 4860 Kc
Sparta stare logo kruh v obdelniku: min. 150x90cm, 7660 Kc
Sparta logo dres nazev: min. 120x80cm, 5760 Kc
FC Viktoria Plzen: min. 90cm vyska, 4860 Kc

PRAVIDLA:
STATUS nelze: fotorealisticke motivy, portrely, fotografie, gradienty, akvarely.
STATUS grafik: nejasne hranice barev, vice nez 8 barev, nizka kvalita, drobne detaily. Grafika ZDARMA pri objednavce nebo 1000 Kc samostatne.
STATUS ok: jasne ohranicene barevne plochy, max 6-8 barev, ciste logo znak text.

NACENENI:
Jednoduchy kulate geometricky znak 1-3 barvy: jako BVB Sparta = 2860-3760 Kc, min 60-70cm
Sportovni logo stredni slozitosti 3-5 barev: jako Real Arsenal Plzen = 4760-5860 Kc, min 80-90cm
Slozite logo vice prvku 5-7 barev: jako Chelsea Harley Slovan = 5760-6360 Kc, min 90-100cm
Velmi slozite vzory 7-8 barev obdelnik: jako Liverpool Sparta stare = 7660-8660 Kc, min 120-150cm
Pokud cena presahuje 8660 Kc: cena_od null cena_do null.

Odpovez POUZE validnim JSON bez backticks:
{"status":"ok","cena_od":3360,"cena_do":4860,"rozmer_min":"90x90 cm","rozmer_doporuceny":"100x100 cm","tvar":"kruh","barvy_odhadnuto":4,"slozitost":"stredni","analyza":"2-4 vety cesky","grafik_duvod":"proc potrebuje grafiku","grafik_cena_info":"Zdarma pri objednavce koberce"}`;

let imageBase64=null,imageMediaType='image/jpeg',analysisResult=null;
const fileInput=document.getElementById('fileInput');
const uploadZone=document.getElementById('uploadZone');
const previewWrap=document.getElementById('previewWrap');
const previewImg=document.getElementById('previewImg');
const removeBtn=document.getElementById('removeBtn');
const analyzeBtn=document.getElementById('analyzeBtn');
const phase1=document.getElementById('phase1');
const loadingDiv=document.getElementById('loadingDiv');
const resultDiv=document.getElementById('resultDiv');
const successDiv=document.getElementById('successDiv');
const steps=[1,2,3,4].map(n=>document.getElementById('si'+n));

function setStep(n){steps.forEach((s,i)=>s.className='step-item '+(i<n?'done':i===n?'active':''));}

function handleFile(file){
  if(!file||!file.type.startsWith('image/'))return;
  imageMediaType=file.type||'image/jpeg';
  const reader=new FileReader();
  reader.onload=e=>{
    imageBase64=e.target.result.split(',')[1];
    previewImg.src=e.target.result;
    uploadZone.style.display='none';
    previewWrap.classList.add('show');
    analyzeBtn.disabled=false;
  };
  reader.readAsDataURL(file);
}

fileInput.addEventListener('change',e=>handleFile(e.target.files[0]));
uploadZone.addEventListener('dragover',e=>{e.preventDefault();uploadZone.classList.add('over');});
uploadZone.addEventListener('dragleave',()=>uploadZone.classList.remove('over'));
uploadZone.addEventListener('drop',e=>{e.preventDefault();uploadZone.classList.remove('over');handleFile(e.dataTransfer.files[0]);});
removeBtn.addEventListener('click',()=>{
  imageBase64=null;previewWrap.classList.remove('show');
  uploadZone.style.display='';previewImg.src='';fileInput.value='';analyzeBtn.disabled=true;
});

analyzeBtn.addEventListener('click',async()=>{
  if(!imageBase64)return;
  phase1.style.display='none';loadingDiv.classList.add('show');setStep(1);
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':API_KEY,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({
        model:'claude-opus-4-6',max_tokens:1000,system:SYSTEM_PROMPT,
        messages:[{role:'user',content:[
          {type:'image',source:{type:'base64',media_type:imageMediaType,data:imageBase64}},
          {type:'text',text:'Analyzuj tento vzor. Odpovez POUZE validnim JSON.'}
        ]}]
      })
    });
    if(!resp.ok)throw new Error('API '+resp.status);
    const data=await resp.json();
    const raw=data.content?.find(b=>b.type==='text')?.text||'';
    const match=raw.match(/\{[\s\S]*\}/);
    if(!match)throw new Error('No JSON');
    analysisResult=JSON.parse(match[0]);
  }catch(err){
    console.error(err);
    analysisResult={status:'grafik',cena_od:null,cena_do:null,rozmer_min:'dle vzoru',rozmer_doporuceny:'dle vzoru',tvar:'jiny',barvy_odhadnuto:null,slozitost:'stredni',analyza:'Vzor se nepodarilo analyzovat. Kontaktuj nas primo na voklcustom@gmail.com.',grafik_duvod:'Automaticka analyza selhala.',grafik_cena_info:'Zdarma pri objednavce koberce'};
  }
  loadingDiv.classList.remove('show');renderResult(analysisResult);setStep(2);
});

function renderResult(r){
  resultDiv.classList.add('show');
  const bm={ok:['badge-ok','OK ‚Äì Vzor je pripraven k vyrobe'],grafik:['badge-grafik','Vzor potrebuje grafickou upravu'],nelze:['badge-no','Vzor neni vhodny pro taftovani']};
  const[bcls,btxt]=bm[r.status]||bm.grafik;
  document.getElementById('statusBadge').innerHTML='<div class="status-badge '+bcls+'">'+btxt+'</div>';
  const pg=document.getElementById('priceGrid');
  if(r.cena_od&&r.status!=='nelze'){
    pg.innerHTML='<div class="price-grid"><div class="pbox gold"><div class="pbox-label">Orientacni cena</div><div class="pbox-val">'+Number(r.cena_od).toLocaleString('cs')+'‚Äì'+Number(r.cena_do).toLocaleString('cs')+' Kc</div><div class="pbox-note">Hotovy koberec vc. vyroby</div></div><div class="pbox"><div class="pbox-label">Doporuceny rozmer</div><div class="pbox-val" style="font-size:1.5rem">'+r.rozmer_doporuceny+'</div><div class="pbox-note">Minimum: '+r.rozmer_min+'</div></div><div class="pbox"><div class="pbox-label">Slozitost vzoru</div><div class="pbox-val" style="font-size:1.3rem">'+(r.slozitost||'‚Äì')+'</div><div class="pbox-note">Tvar: '+(r.tvar||'‚Äì')+'</div></div><div class="pbox"><div class="pbox-label">Pocet barev odhad</div><div class="pbox-val">'+(r.barvy_odhadnuto||'‚Äì')+'</div><div class="pbox-note">Max. 8 z palety 65 odstinu</div></div></div>';
  }else if(r.status!=='nelze'){
    pg.innerHTML='<div class="price-grid"><div class="pbox gold"><div class="pbox-label">Cena</div><div class="pbox-val" style="font-size:1.2rem">Individualni</div><div class="pbox-note">Upresnime po graficke uprave</div></div><div class="pbox"><div class="pbox-label">Doporuceny rozmer</div><div class="pbox-val" style="font-size:1.5rem">'+(r.rozmer_doporuceny||'‚Äì')+'</div><div class="pbox-note">Minimum: '+(r.rozmer_min||'‚Äì')+'</div></div></div>';
  }else{pg.innerHTML='';}
  document.getElementById('analysisBox').textContent=r.analyza||'';
  const gn=document.getElementById('grafikNotice');
  if(r.status==='grafik'&&r.grafik_duvod){
    gn.innerHTML='<div class="grafik-notice"><strong>Proc je potreba graficka uprava?</strong><br>'+r.grafik_duvod+'<br><br><strong>Cena grafiky:</strong> '+(r.grafik_cena_info||'Zdarma pri objednavce')+'</div>';
  }else if(r.status==='nelze'){
    gn.innerHTML='<div class="grafik-notice" style="border-color:rgba(201,79,61,0.3);background:rgba(201,79,61,0.06)"><strong style="color:var(--red)">Proc tento vzor nelze vyrobit?</strong><br>'+(r.grafik_duvod||'Taftovany koberec nepodporuje jemne prechody barev.')+'<br><br>Pokud mas jiny vzor, napi≈° nam.</div>';
    document.getElementById('contactDesc').textContent='Mas jiny vzor nebo chces poradit? Napis nam.';
  }else{gn.innerHTML='';}
  setStep(3);
}

document.getElementById('sendBtn').addEventListener('click',()=>{
  const name=document.getElementById('cName').value.trim();
  const email=document.getElementById('cEmail').value.trim();
  if(!name||!email){alert('Vypl≈à prosim jmeno a e-mail.');return;}
  const btn=document.getElementById('sendBtn');
  btn.disabled=true;btn.textContent='Odesilam...';
  const r=analysisResult||{};
  const subject=encodeURIComponent('Poptavka zak√°zkov√©ho koberce ‚Äì '+name);
  const body=encodeURIComponent(['Nova poptavka z webu Voklcreate','','Zakaznik: '+name,'E-mail: '+email,'Telefon: '+(document.getElementById('cPhone').value||'‚Äì'),'Preferovany rozmer: '+(document.getElementById('cSize').value||r.rozmer_doporuceny||'‚Äì'),'Poznamka: '+(document.getElementById('cNote').value||'‚Äì'),'','‚îÄ‚îÄ Vysledek AI analyzy ‚îÄ‚îÄ','Status: '+(r.status||'‚Äì'),'Cena: '+(r.cena_od?r.cena_od+'‚Äì'+r.cena_do+' Kc':'individualni'),'Rozmer: '+(r.rozmer_doporuceny||'‚Äì'),'Slozitost: '+(r.slozitost||'‚Äì'),'Analyza: '+(r.analyza||'‚Äì')].join('\n'));
  window.location.href='mailto:'+OWNER_EMAIL+'?subject='+subject+'&body='+body;
  setTimeout(()=>{resultDiv.classList.remove('show');successDiv.classList.add('show');setStep(4);},1000);
});

function restart(){
  imageBase64=null;analysisResult=null;fileInput.value='';previewImg.src='';
  previewWrap.classList.remove('show');uploadZone.style.display='';analyzeBtn.disabled=true;
  phase1.style.display='block';loadingDiv.classList.remove('show');
  resultDiv.classList.remove('show');successDiv.classList.remove('show');
  ['cName','cEmail','cPhone','cSize','cNote'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('contactDesc').textContent='Vypl≈à kontaktni udaje ‚Äî ozveme se s potvrzenim.';
  setStep(0);
}
document.getElementById('restartBtn').addEventListener('click',restart);
document.getElementById('restartBtn2').addEventListener('click',restart);
</script>
</body>
</html>
